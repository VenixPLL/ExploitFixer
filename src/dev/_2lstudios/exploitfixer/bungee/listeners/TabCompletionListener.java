package dev._2lstudios.exploitfixer.bungee.listeners;

import dev._2lstudios.exploitfixer.bungee.managers.ModuleManager;
import dev._2lstudios.exploitfixer.shared.modules.NotificationsModule;
import net.md_5.bungee.UserConnection;
import net.md_5.bungee.api.event.TabCompleteEvent;
import net.md_5.bungee.api.plugin.Listener;
import net.md_5.bungee.event.EventHandler;
import net.md_5.bungee.event.EventPriority;

public class TabCompletionListener implements Listener {

    private NotificationsModule notificationsModule;

    TabCompletionListener(final ModuleManager moduleManager) {
        this.notificationsModule = moduleManager.getNotificationsModule();
    }

    @EventHandler(priority = EventPriority.LOWEST)
    public void onTabCompletion(TabCompleteEvent event){
        if(!(event.getSender() instanceof UserConnection)) return;

        final String cursor = event.getCursor();
        if(cursor.startsWith("/") && (cursor.contains("for(") || (cursor.contains("{") && cursor.contains("}")))) {
            final UserConnection sender = (UserConnection) event.getSender();

            this.notificationsModule.debug(sender.getName() + " Tried to crash server using FAWE(FastAsyncWorldEdit) Exploit");
            event.setCancelled(true);
        }
    }

}